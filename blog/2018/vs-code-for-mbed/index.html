<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>VS Code IDE for mbed Projects | Siraj Muhammad, Ph.D.</title>
  <meta name="description" content="">

  <link rel="shortcut icon" href="/assets/img/favicon.ico">

  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="canonical" href="/blog/2018/vs-code-for-mbed/">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    
    <a class="header-logo" href="/"></a>
    

    <nav class="site-nav">
      <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

      <div class="trigger">


		
        <!-- Research -->
        <a class="page-link" href="/research/">research</a>
		
        <!-- Publications -->
        <a class="page-link" href="/publications/">publications</a>
		
        <!-- CV link -->
        <a class="page-link" href="/resume/" target="_blank">resume</a>
		
        <!-- Blog -->
        <a class="page-link" href="/blog/">blog</a>
		
        <!-- Travel -->
        <a class="page-link" href="/travel/">travel</a>
		
        <!-- Poetry -->
        <a class="page-link" href="/poetry/">poetry</a>

      </div>
    </nav>

  </div>

</header>



    <div class="page-content">
      <div class="wrapper">
        <div class="post" dir="">

  <header class="post-header">
    <h1 class="post-title">VS Code IDE for mbed Projects</h1>
    <p class="post-meta">December 14, 2018 ‚Ä¢ Siraj Muhammad</p>
  </header>

  <article class="post-content">
    <h2 id="introduction">Introduction</h2>

<p>If you are working with STMicroelectronics‚Äô F0 and L0 family of microcontrollers, you are propably using Keil uVision as your IDE. However, if you try to use fancy stuff like mbed OS, and uTensor (this was actually the reason behind this article) on a relativley higher end microcontrollers, you are most likely going to get hit with the IDE dilemma. There are no modern, kinda proffesional, easy to install and use IDEs that are free! I mean, not really, otherwise, I would not have written this article üòÅ</p>

<p>In this post, I will detail a step-by-step guide to set up a functional <a href="https://code.visualstudio.com/">VS Code</a> IDE to work with projects exported from mbed-cli tool, on a Windows 10 environment.
In this tutorial I am using STM32L4 Discovery kit IoT node (in mbed, this is known as DISCO_L475VG_IOT01A).</p>

<h2 id="steps">Steps</h2>

<ol>
  <li>Install Visual Studio Code (<a href="https://code.visualstudio.com/">link</a>).</li>
  <li>Download and install GNU Tools ARM Embedded (<a href="https://developer.arm.com/open-source/gnu-toolchain/gnu-rm/downloads">link</a>).</li>
  <li>This will be installed in <code class="language-plaintext highlighter-rouge">C:\Program Files (x86)\GNU Tools Arm Embedded</code>.</li>
  <li>Add the <code class="language-plaintext highlighter-rouge">\bin</code> folder to your <code class="language-plaintext highlighter-rouge">PATH</code> environment variable (e.g., <code class="language-plaintext highlighter-rouge">C:\Program Files (x86)\GNU Tools ARM Embedded\6 2017-q2-update\bin</code>).</li>
  <li>Download GNU Make Windows Build Tools (<a href="https://github.com/gnu-mcu-eclipse/windows-build-tools/releases">link</a>).</li>
  <li>Extract the GNU Make files to a path (e.g., <code class="language-plaintext highlighter-rouge">C:\Program Files\</code>).</li>
  <li>Add the <code class="language-plaintext highlighter-rouge">\bin</code> folder to the <code class="language-plaintext highlighter-rouge">PATH</code> environment variable (e.g., <code class="language-plaintext highlighter-rouge">C:\Program Files\GNU MCU Eclipse\Build Tools\2.10-20180103-1919\bin</code>).</li>
  <li>Download and install Python 2.7 (<a href="https://www.python.org/downloads/windows/">link</a>).</li>
  <li>Make sure you also install <code class="language-plaintext highlighter-rouge">pip</code> with the Python package.</li>
  <li>From command line, install mbed CLI:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>mbed-cli
</code></pre></div>    </div>
  </li>
  <li>Now you can export mbed projects to VS Code or any other IDE. To export to VS Code, from the project parent folder run:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mbed <span class="nb">export</span> <span class="nt">--ide</span> vscode_gcc_arm <span class="nt">--target</span> DISCO_L475VG_IOT01A
</code></pre></div>    </div>
  </li>
  <li>Change target to match yours. Run the following command to get a list of supported targets and toolchains:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mbed target <span class="nt">-S</span>
</code></pre></div>    </div>
  </li>
  <li>For a complete matrix of supported targets and IDEs, run:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mbed export -S
</code></pre></div>    </div>
  </li>
  <li>Export Makefile from mbed CLI:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mbed <span class="nb">export</span> <span class="nt">--ide</span> make_gcc_arm <span class="nt">--target</span> DISCO_L475VG_IOT01A
</code></pre></div>    </div>
  </li>
  <li>This will create a Makefile required by GNU Make to compile your project.</li>
  <li>Open the project folder with VS Code after exporting from mbed CLI.</li>
  <li>Open folder <code class="language-plaintext highlighter-rouge">.vscode</code> and edit file <code class="language-plaintext highlighter-rouge">launch.json</code>. Change field <code class="language-plaintext highlighter-rouge">MIDebuggerPath</code> under <code class="language-plaintext highlighter-rouge">windows</code> to be:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"MIDebuggerPath"</span>: <span class="s2">"arm-none-eabi-gdb.exe"</span>,
</code></pre></div>    </div>
  </li>
  <li>Clear the field <code class="language-plaintext highlighter-rouge">serverStarted</code>, as this looks for a specific pattern in the output to start the GDB server. It‚Äôs causing problems in launching the GDB.
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="s2">"serverStarted"</span>: <span class="s2">""</span>,
</code></pre></div>    </div>
  </li>
  <li>If you get <code class="language-plaintext highlighter-rouge">Make error 87</code>, this is because the makefile is passing a long command more than Windows API can process. Change the linking command in the makefile to be:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="si">$(</span>PROJECT<span class="si">)</span>.elf: <span class="si">$(</span>OBJECTS<span class="si">)</span> <span class="si">$(</span>SYS_OBJECTS<span class="si">)</span> <span class="si">$(</span>PROJECT<span class="si">)</span>.link_script.ld 
    <span class="si">$(</span>file <span class="o">&gt;</span> <span class="nv">$@</span>.in, <span class="si">$(</span>filter %.o, <span class="nv">$^</span><span class="si">))</span>
    +@echo <span class="s2">"link: </span><span class="si">$(</span>notdir <span class="nv">$@</span><span class="si">)</span><span class="s2">"</span>
    <span class="si">$(</span>LD<span class="si">)</span>   <span class="si">$(</span>LD_FLAGS<span class="si">)</span> <span class="nt">-T</span> <span class="si">$(</span>filter-out %.o, <span class="nv">$^</span><span class="si">)</span> <span class="si">$(</span>LIBRARY_PATHS<span class="si">)</span> <span class="nt">--output</span> <span class="nv">$@</span> @<span class="nv">$@</span>.in <span class="si">$(</span>LIBRARIES<span class="si">)</span> <span class="si">$(</span>LD_SYS_LIBS<span class="si">)</span>
</code></pre></div>    </div>
    <p>Instead of:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="si">$(</span>PROJECT<span class="si">)</span>.elf: <span class="si">$(</span>OBJECTS<span class="si">)</span> <span class="si">$(</span>SYS_OBJECTS<span class="si">)</span> <span class="si">$(</span>PROJECT<span class="si">)</span>.link_script.ld 
    +@echo <span class="s2">"link: </span><span class="si">$(</span>notdir <span class="nv">$@</span><span class="si">)</span><span class="s2">"</span>
    @<span class="si">$(</span>LD<span class="si">)</span> <span class="si">$(</span>LD_FLAGS<span class="si">)</span> <span class="nt">-T</span> <span class="si">$(</span>filter-out %.o, <span class="nv">$^</span><span class="si">)</span> <span class="si">$(</span>LIBRARY_PATHS<span class="si">)</span> <span class="nt">--output</span> <span class="nv">$@</span> <span class="si">$(</span>filter %.o, <span class="nv">$^</span><span class="si">)</span> <span class="si">$(</span>LIBRARIES<span class="si">)</span> <span class="si">$(</span>LD_SYS_LIBS<span class="si">)</span>
</code></pre></div>    </div>
    <p>What this does is that it breaks the command into two sections.
(Note: there is a tab at the beginning of the second, third, and fourth lines).</p>
  </li>
  <li>If your source is C++ and you get errors about C++11 standard, make sure that <code class="language-plaintext highlighter-rouge">-std=c++11</code> is defined in <code class="language-plaintext highlighter-rouge">CPP</code> and <code class="language-plaintext highlighter-rouge">CXX_FLAGS</code> objects in the makefile. For example:
    <div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">CPP</span>     <span class="o">=</span> <span class="s1">'arm-none-eabi-g++'</span> <span class="s1">'-std=c++11'</span> <span class="s1">'-fno-rtti'</span> <span class="s1">'-Wvla'</span> <span class="s1">'-c'</span> <span class="s1">'-Wall'</span> <span class="s1">'-Wextra'</span> <span class="s1">'-Wno-unused-parameter'</span> <span class="s1">'-Wno-missing-field-initializers'</span> <span class="s1">'-fmessage-length=0'</span> <span class="s1">'-fno-exceptions'</span> <span class="s1">'-fno-builtin'</span> <span class="s1">'-ffunction-sections'</span> <span class="s1">'-fdata-sections'</span> <span class="s1">'-funsigned-char'</span> <span class="s1">'-MMD'</span> <span class="s1">'-fno-delete-null-pointer-checks'</span> <span class="s1">'-fomit-frame-pointer'</span> <span class="s1">'-O0'</span> <span class="s1">'-g3'</span> <span class="s1">'-DMBED_DEBUG'</span> <span class="s1">'-DMBED_TRAP_ERRORS_ENABLED=1'</span> <span class="s1">'-mcpu=cortex-m4'</span> <span class="s1">'-mthumb'</span> <span class="s1">'-mfpu=fpv4-sp-d16'</span> <span class="s1">'-mfloat-abi=softfp'</span>

<span class="err">...</span>

<span class="nv">CXX_FLAGS</span> <span class="o">+=</span> <span class="nt">-std</span><span class="o">=</span>c++11
<span class="nv">CXX_FLAGS</span> <span class="o">+=</span> <span class="nt">-fno-rtti</span>
<span class="nv">CXX_FLAGS</span> <span class="o">+=</span> <span class="nt">-Wvla</span>
<span class="nv">CXX_FLAGS</span> <span class="o">+=</span> <span class="nt">-DDEVICE_I2C</span><span class="o">=</span>1

<span class="err">...</span>
</code></pre></div>    </div>
  </li>
  <li>So far, we haven‚Äôt setup the debugger yet. If you are using ST-LINK, you probably want to use OpenOCD. Other options available are SEGGER‚Äôs J-Link but this requires upgrading the ST-LINK to a J-Link firmware.</li>
  <li>Download and extract OpenOCD binaries for Windows somewhere (<a href="http://www.freddiechopin.info/en/download/category/4-openocd">link</a>). e.g., <code class="language-plaintext highlighter-rouge">C:\openocd-0.10.0\</code>.</li>
  <li>Add the <code class="language-plaintext highlighter-rouge">\bin</code> folder to your <code class="language-plaintext highlighter-rouge">PATH</code> environment variable (e.g., <code class="language-plaintext highlighter-rouge">C:\openocd-0.10.0\bin</code>).</li>
  <li>In <code class="language-plaintext highlighter-rouge">launch.json</code>, edit the field <code class="language-plaintext highlighter-rouge">debugServerPath</code> to be:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"debugServerPath"</span>: <span class="s2">"openocd.exe"</span>,
</code></pre></div>    </div>
    <p>Note: if you don‚Äôt add the <code class="language-plaintext highlighter-rouge">\bin</code> folder to your <code class="language-plaintext highlighter-rouge">PATH</code>, you should provide the full path to your <code class="language-plaintext highlighter-rouge">openocd.exe</code>. Make sure you can call <code class="language-plaintext highlighter-rouge">openocd.exe</code> directly from any command line prompt.</p>
  </li>
  <li>Edit the filed <code class="language-plaintext highlighter-rouge">debugServerArgs</code> to add parameters to be passed to your <code class="language-plaintext highlighter-rouge">openocd.exe</code> call. This Tells OpenOCD what board/MCU you are trying to connect to.
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"debugServerArgs"</span>: <span class="s2">"-f C:</span><span class="se">\\</span><span class="s2">openocd-0.10.0</span><span class="se">\\</span><span class="s2">scripts</span><span class="se">\\</span><span class="s2">board</span><span class="se">\\</span><span class="s2">stm32l4discovery.cfg -f C:</span><span class="se">\\</span><span class="s2">openocd-0.10.0</span><span class="se">\\</span><span class="s2">scripts</span><span class="se">\\</span><span class="s2">interface</span><span class="se">\\</span><span class="s2">stlink-v2-1.cfg -c init -c </span><span class="se">\"</span><span class="s2">reset init</span><span class="se">\"</span><span class="s2">"</span>,
</code></pre></div>    </div>
    <p>Note that you have to provide the full path to your configuration files. You can check supported boards by browsing the <code class="language-plaintext highlighter-rouge">\board</code> folders.</p>
  </li>
  <li>In the Debug tab, hit the play button to start debugging.</li>
</ol>

  </article>

  

</div>

      </div>
    </div>

    <footer>

  <div align="center" class="wrapper">
    &copy; Copyright 2021 Siraj Muhammad, Ph.D.
    
    
  </div>

</footer>


    <!-- Load jQuery -->
<script src="//code.jquery.com/jquery-1.12.4.min.js"></script>

<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>


<!-- Load KaTeX -->
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.js"></script>
<script src="/assets/js/katex.js"></script>




<!-- Include custom icon fonts -->
<link rel="stylesheet" href="/assets/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/assets/css/academicons.min.css">




  </body>

</html>
